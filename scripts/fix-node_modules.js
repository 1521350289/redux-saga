/* eslint-disable no-console */
const { promisify } = require('util')
const { resolve } = require('path')
const fs = require('fs')
const stat = promisify(fs.stat)
const isDir = name =>
	stat(name)
		.then(stats => stats.isDirectory())
		.catch(() => false)
const rimraf = promisify(require('rimraf'))

const duplicateBabel = resolve(__dirname, '../node_modules/babel-7-jest/node_modules/@babel')

isDir(duplicateBabel).then(exists => {
	if (!exists) {
		console.error('Unexpected situation. There is no babel-7-jest/node_modules/@babel dir.')
		process.exit(1)
	}

	return rimraf(duplicateBabel).then(
		() => console.log('Removed @babel packages from babel-7-jest/node_modules.'),
	)
})
